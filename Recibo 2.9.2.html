<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Recibos e Etiquetas - CD Caxias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .print-only { display: none; }
        .no-print { display: block; }
        .recibo-header { background: linear-gradient(to right, #0F7B97, #0A4D61); }
        .etiqueta-container { background: linear-gradient(to bottom, rgba(244, 249, 251, 0.7), rgba(230, 243, 248, 0.7)); }
        .section-divider { background: repeating-linear-gradient(90deg, transparent, transparent 5px, #0F7B97 5px, #0F7B97 8px); height: 2px; }
        .expedition-wrapper { display: flex; gap: 1rem; width: 100%; }
        .expedition-container { flex: 1; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; display: flex; flex-direction: column; justify-content: space-between; min-height: 170px; box-sizing: border-box; }
        .assinatura-line { border-bottom: 1px solid #000; width: 100%; height: 1px; }
        
        .signature-pad-container {
            width: 100%;
            margin: 0.5rem 0;
        }

        .signature-pad {
            width: 100%;
            height: 100px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background-color: #f8fafc;
            touch-action: none;
        }

        .signature-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .signature-image img {
            max-width: 200px;
            height: auto;
            border-bottom: 1px solid #000;
            margin-bottom: 0.5rem;
        }

        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 2% auto; padding: 20px; border: 1px solid #888; width: auto; max-width: 600px; border-radius: 0.5rem; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); }
        
        @media print {
            body * { visibility: hidden; margin: 0; padding: 0; }
            .recibo-container, .recibo-container *, .etiqueta-container, .etiqueta-container * { visibility: visible; }
            .recibo-container, .etiqueta-container { position: absolute; left: 0; top: 0; width: 100%; padding: 0; box-shadow: none; page-break-after: avoid; page-break-inside: avoid; height: auto; margin: 0; }
            .recibo-destino { font-size: 20pt !important; font-weight: bold !important; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .expedition-wrapper { display: flex !important; flex-direction: row !important; justify-content: space-between !important; gap: 1rem !important; width: 100% !important; }
            .expedition-container { flex: 1 !important; min-height: 170px !important; max-height: 180px !important; display: flex !important; flex-direction: column !important; justify-content: space-between !important; border: 1px solid #e2e8f00 !important; box-sizing: border-box !important; }
            .assinatura-line { border-bottom: 1px solid #000 !important; height: 1px !important; width: 100% !important; }
            .text-xs { font-size: 10pt !important; }
            .text-lg { font-size: 14pt !important; }
            .section-divider { margin: 8px 0 !important; }
            .recibo-header { padding: 12px 16px !important; }
            .signature-pad-container { display: none !important; }
            .signature-image { display: block !important; max-width: 100%; height: auto; margin-bottom: 10px; }
            @page { size: auto; margin: 0mm; }
        }

        @media (max-width: 640px) {
            .signature-pad-container { display: block; margin-bottom: 1rem; }
            .signature-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
            .signature-actions button { padding: 0.5rem 1rem; border-radius: 0.25rem; font-size: 0.875rem; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-4 sm:p-6">
        <!-- Tela principal -->
        <div id="mainScreen">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-bold text-primary-dark mb-2">
                    <i class="fas fa-file-invoice text-primary-dark"></i> Sistema de Recibos e Etiquetas
                </h1>
                <p class="text-gray-600">Controle de materiais distribuídos pelo CD Caxias</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="recibo-header py-3 px-6 flex items-center">
                    <i class="fas fa-file-pen text-white text-xl mr-3"></i>
                    <h2 class="text-white text-xl font-bold">Dados do Recibo</h2>
                </div>
                
                <form id="reciboForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Campo de Data -->
                        <div class="col-span-1">
                            <label class="block text-gray-700 font-medium mb-2">
                                <i class="fas fa-calendar text-primary mr-1"></i> Data
                            </label>
                            <div class="relative">
                                <input type="text" id="data" name="data" readonly 
                                    class="w-full px-4 py-2.5 bg-gray-100 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            </div>
                        </div>

                        <!-- Tipo de Material -->
                        <div class="col-span-1">
                            <label class="block text-gray-700 font-medium mb-2">
                                <i class="fas fa-boxes text-primary mr-1"></i> Tipo de Material
                            </label>
                            <div class="flex items-end">
                                <span class="text-xs text-gray-500 mr-2">(TI, Suprimentos, Marketing, Doações, outros...)</span>
                                <input type="text" id="tipoMaterial" name="tipoMaterial" value="TI" 
                                       class="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            </div>
                        </div>
                    </div>

                    <!-- Destino -->
                    <div class="mt-6">
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-location-dot text-primary mr-1"></i> Destino
                        </label>
                        <div class="relative">
                            <select id="destino" name="destino" required 
                                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light appearance-none">
                                <option value="">Selecione um destino</option>
                                <option value="Callcenter - V02">Callcenter - V02</option>
                                <option value="Manutenção - Vila Isabel">Manutenção - Vila Isabel</option>
                                <option value="Matriz Barra">Matriz Barra</option>
                                <option value="Matriz Barra - TI">Matriz Barra - TI</option>
                                <script>
                                    for (let i = 1; i <= 200; i++) {
                                        let value = 'V' + (i < 10 ? '0' + i : i);
                                        document.write(`<option value="${value}">${value}</option>`);
                                    }
                                    document.write('<option value="V515">V515</option>');
                                    document.write('<option value="V555">V555</option>');
                                </script>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-700">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Responsável pela Entrega -->
                    <div class="mt-6">
                        <label class="block text-gray-700 font-medium mb-3">
                            <i class="fas fa-user-tie text-primary mr-1"></i> Responsável pela Entrega do Material na Expedição
                        </label>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <label class="flex items-center cursor-pointer border rounded-lg p-3 hover:bg-blue-50">
                                <input type="radio" name="responsavelEntrega" value="Adauto Lima" required class="h-5 w-5 text-primary">
                                <span class="ml-3 text-gray-700">Adauto Lima</span>
                            </label>
                            <label class="flex items-center cursor-pointer border rounded-lg p-3 hover:bg-blue-50">
                                <input type="radio" name="responsavelEntrega" value="Juan Alves" class="h-5 w-5 text-primary">
                                <span class="ml-3 text-gray-700">Juan Alves</span>
                            </label>
                            <label class="flex items-center cursor-pointer border rounded-lg p-3 hover:bg-blue-50">
                                <input type="radio" name="responsavelEntrega" value="Marlos Castro" class="h-5 w-5 text-primary">
                                <span class="ml-3 text-gray-700">Marlos Castro</span>
                            </label>
                        </div>
                    </div>

                    <!-- Campos para Loja -->
                    <div id="materialLoja" class="mt-6 p-5 rounded-lg etiqueta-container">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <i class="fas fa-boxes-stacked text-primary mr-1"></i> Material
                                </label>
                                <input type="text" id="materialLojaInput" name="materialLojaInput" placeholder="Ex: 2 SP30 e 5 leitores Symbol" 
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <i class="fas fa-ticket text-primary mr-1"></i> Chamado
                                </label>
                                <input type="text" id="chamadoLoja" name="chamadoLoja" placeholder="Número do chamado" 
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <i class="fas fa-user text-primary mr-1"></i> A/C:
                                </label>
                                <input type="text" id="acLoja" name="acLoja" placeholder="Nome da pessoa responsável" 
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">
                                    <i class="fas fa-box text-primary mr-1"></i> Quantidade de Volumes
                                </label>
                                <div class="number-input">
                                    <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepDown()">-</button>
                                    <input id="quantidadeVolumes" class="quantity" min="1" name="quantidadeVolumes" value="1" type="number">
                                    <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepUp()">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-gray-700 font-medium mb-2">
                                <i class="fas fa-comment text-primary mr-1"></i> Observação:
                            </label>
                            <input type="text" id="observacao" name="observacao" placeholder="Observações adicionais" 
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                        </div>
                    </div>
                    
                    <!-- Botões -->
                    <div class="mt-8 flex flex-wrap justify-center gap-4">
                        <button type="button" id="imprimirRecibo" class="px-6 py-3 bg-gradient-to-r from-primary to-primary-dark text-white rounded-lg hover:opacity-90 transition duration-300 font-medium shadow-md flex items-center no-print">
                            <i class="fas fa-print mr-2"></i> IMPRIMIR RECIBO
                        </button>
                        <button type="button" id="imprimirEtiqueta" class="px-6 py-3 bg-gradient-to-r from-accent to-green-600 text-white rounded-lg hover:opacity-90 transition duration-300 font-medium shadow-md flex items-center no-print">
                            <i class="fas fa-tag mr-2"></i> IMPRIMIR ETIQUETA
                        </button>
                    </div>
                </form>
            </div>

            <!-- Botão para acessar histórico -->
            <div class="mt-6 text-center">
                <button id="verHistorico" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-300 font-medium shadow-md flex items-center mx-auto no-print">
                    <i class="fas fa-history mr-2"></i> HISTÓRICO DE RECIBOS
                </button>
            </div>
        </div>

        <!-- Recibo Gerado -->
        <div id="reciboResult" class="mt-8 hidden">
            <div class="flex flex-col md:flex-row gap-6">
                <div class="recibo-container bg-white rounded-xl shadow-lg overflow-hidden print:w-full print:shadow-none print:rounded-none flex-1">
                    <div class="recibo-header py-4 px-6 flex items-center justify-center">
                        <h2 class="text-white text-xl md:text-2xl font-bold uppercase">Recibo de Materiais Diversos Distribuídos pelo CD Caxias</h2>
                    </div>
                    
                    <div class="p-6">
                        <!-- Conteúdo do recibo será preenchido aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tela de Histórico -->
        <div id="historicoScreen" class="hidden">
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-bold text-primary-dark mb-2">
                    <i class="fas fa-history text-primary-dark"></i> Histórico de Recibos
                </h1>
                <p class="text-gray-600">Recibos gerados para assinatura digital</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center">
                            <button id="voltarParaPrincipal" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 mr-4">
                                <i class="fas fa-arrow-left mr-2"></i> Voltar
                            </button>
                            <h2 class="text-lg font-semibold text-primary-dark">Recibos Gerados</h2>
                        </div>
                        <div class="flex items-center">
                            <input type="text" id="buscaRecibo" placeholder="Buscar recibos..." class="px-4 py-2 border border-gray-300 rounded-lg focus:border-primary focus:ring focus:ring-primary-light">
                            <button id="limparBusca" class="ml-2 px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="listaRecibos" class="space-y-4">
                        <!-- Recibos serão carregados aqui dinamicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Assinatura -->
        <div id="assinaturaModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 class="text-xl font-bold text-primary-dark mb-4 text-center">Assinatura Digital</h2>
                
                <div class="mb-4">
                    <div class="font-semibold mb-2">Recibo #<span id="reciboId"></span></div>
                    <div id="reciboResumo" class="text-sm text-gray-600"></div>
                </div>
                
                <div class="signature-pad-container">
                    <canvas class="signature-pad"></canvas>
                    <div class="signature-actions mt-2">
                        <button type="button" class="clear-signature px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">
                            <i class="fas fa-eraser mr-2"></i> Limpar
                        </button>
                        <button type="button" class="save-signature px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark ml-2">
                            <i class="fas fa-save mr-2"></i> Salvar Assinatura
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <button id="cancelarAssinatura" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 mr-2">
                        <i class="fas fa-times mr-2"></i> Cancelar
                    </button>
                    <button id="gerarPDF" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                        <i class="fas fa-file-pdf mr-2"></i> Gerar PDF
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal da Etiqueta -->
        <div id="etiquetaModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 class="text-xl font-bold text-primary-dark mb-2 text-center">Pré-visualização da Etiqueta</h2>
                <div class="flex justify-center">
                    <div id="etiquetaPreview" class="etiqueta-venancio etiqueta-loja">
                        <!-- Conteúdo será inserido aqui pelo JavaScript -->
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <button id="imprimirEtiquetaModal" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark">
                        <i class="fas fa-print mr-2"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Constantes e variáveis globais
            const RECIBOS_STORAGE_KEY = 'recibos_venancio';
            let recibosGerados = JSON.parse(localStorage.getItem(RECIBOS_STORAGE_KEY)) || [];
            let signaturePad = null;
            let reciboAtualParaAssinar = null;

            // Elementos do DOM
            const elements = {
                mainScreen: document.getElementById('mainScreen'),
                historicoScreen: document.getElementById('historicoScreen'),
                reciboResult: document.getElementById('reciboResult'),
                listaRecibos: document.getElementById('listaRecibos'),
                buscaRecibo: document.getElementById('buscaRecibo'),
                limparBusca: document.getElementById('limparBusca'),
                assinaturaModal: document.getElementById('assinaturaModal'),
                reciboId: document.getElementById('reciboId'),
                reciboResumo: document.getElementById('reciboResumo'),
                verHistorico: document.getElementById('verHistorico'),
                voltarParaPrincipal: document.getElementById('voltarParaPrincipal'),
                data: document.getElementById('data'),
                destino: document.getElementById('destino'),
                radioButtons: document.querySelectorAll('input[name="responsavelEntrega"]'),
                materialLojaInput: document.getElementById('materialLojaInput'),
                chamadoLoja: document.getElementById('chamadoLoja'),
                acLoja: document.getElementById('acLoja'),
                observacao: document.getElementById('observacao'),
                quantidadeVolumes: document.getElementById('quantidadeVolumes'),
                tipoMaterial: document.getElementById('tipoMaterial'),
                imprimirRecibo: document.getElementById('imprimirRecibo'),
                imprimirEtiqueta: document.getElementById('imprimirEtiqueta'),
                etiquetaModal: document.getElementById('etiquetaModal'),
                etiquetaPreview: document.getElementById('etiquetaPreview')
            };

            // Inicialização
            function init() {
                // Preencher data atual
                const hoje = new Date();
                const dia = String(hoje.getDate()).padStart(2, '0');
                const mes = String(hoje.getMonth() + 1).padStart(2, '0');
                const ano = hoje.getFullYear();
                elements.data.value = `${dia}/${mes}/${ano}`;
                
                // Configurar eventos
                setupEventListeners();
                
                // Configurar assinatura digital
                setupSignaturePad();
            }

            // Configurar eventos
            function setupEventListeners() {
                // Campos obrigatórios
                elements.destino.addEventListener('change', atualizarEstadoRecibo);
                elements.radioButtons.forEach(radio => {
                    radio.addEventListener('change', atualizarEstadoRecibo);
                });

                // Outros campos
                const camposAdicionais = ['materialLojaInput', 'chamadoLoja', 'acLoja', 'observacao', 'quantidadeVolumes', 'tipoMaterial'];
                camposAdicionais.forEach(id => {
                    document.getElementById(id).addEventListener('input', gerarRecibo);
                });

                // Botões principais
                elements.imprimirRecibo.addEventListener('click', imprimirReciboHandler);
                elements.imprimirEtiqueta.addEventListener('click', mostrarPreviewEtiqueta);
                elements.verHistorico.addEventListener('click', mostrarHistorico);
                elements.voltarParaPrincipal.addEventListener('click', voltarParaPrincipalHandler);

                // Busca no histórico
                elements.buscaRecibo.addEventListener('input', filtrarRecibos);
                elements.limparBusca.addEventListener('click', limparBusca);

                // Modal de assinatura
                document.querySelector('.close').onclick = fecharModalAssinatura;
                document.querySelector('.clear-signature').addEventListener('click', limparAssinatura);
                document.querySelector('.save-signature').addEventListener('click', salvarAssinatura);
                document.getElementById('gerarPDF').addEventListener('click', gerarPDFHandler);
                document.getElementById('cancelarAssinatura').addEventListener('click', fecharModalAssinatura);

                // Modal de etiqueta
                document.querySelectorAll('.close')[1].onclick = fecharModalEtiqueta;
                document.getElementById('imprimirEtiquetaModal').addEventListener('click', imprimirEtiquetas);

                // Fechar modais ao clicar fora
                window.onclick = function(event) {
                    if (event.target == elements.assinaturaModal) {
                        fecharModalAssinatura();
                    }
                    if (event.target == elements.etiquetaModal) {
                        fecharModalEtiqueta();
                    }
                }
            }

            // Configurar área de assinatura
            function setupSignaturePad() {
                const canvas = document.querySelector(".signature-pad");
                signaturePad = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)'
                });

                // Ajustar tamanho do canvas
                function resizeCanvas() {
                    const ratio = Math.max(window.devicePixelRatio || 1, 1);
                    canvas.width = canvas.offsetWidth * ratio;
                    canvas.height = canvas.offsetHeight * ratio;
                    canvas.getContext("2d").scale(ratio, ratio);
                    signaturePad.clear(); // Limpar assinatura após redimensionamento
                }

                window.addEventListener('resize', resizeCanvas);
                resizeCanvas();
            }

            // Funções principais
            function verificarCamposObrigatorios() {
                const destinoPreenchido = elements.destino.value.trim() !== '';
                const responsavelSelecionado = Array.from(elements.radioButtons).some(radio => radio.checked);
                
                return destinoPreenchido && responsavelSelecionado;
            }

            function atualizarEstadoRecibo() {
                if (verificarCamposObrigatorios()) {
                    gerarRecibo();
                    elements.reciboResult.classList.remove('hidden');
                } else {
                    elements.reciboResult.classList.add('hidden');
                }
            }

            function gerarRecibo() {
                if (!verificarCamposObrigatorios()) return;
                
                const reciboData = {
                    data: elements.data.value,
                    destino: elements.destino.value,
                    material: elements.materialLojaInput.value,
                    chamado: elements.chamadoLoja.value,
                    ac: elements.acLoja.value,
                    observacao: elements.observacao.value,
                    quantidadeVolumes: elements.quantidadeVolumes.value,
                    tipoMaterial: elements.tipoMaterial.value,
                    responsavelEntrega: document.querySelector('input[name="responsavelEntrega"]:checked').value,
                    horarioEntrega: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
                };
                
                salvarRecibo(reciboData);
                atualizarReciboVisualizacao(reciboData);
            }

            function salvarRecibo(reciboData) {
                // Verificar se já existe um recibo não assinado com os mesmos dados
                const reciboExistente = recibosGerados.find(r => 
                    !r.assinado &&
                    r.data === reciboData.data &&
                    r.destino === reciboData.destino &&
                    r.material === reciboData.material
                );

                if (!reciboExistente) {
                    const novoRecibo = {
                        ...reciboData,
                        id: Date.now(),
                        dataCriacao: new Date().toISOString(),
                        assinado: false,
                        pdfGerado: false,
                        assinatura: null,
                        dataAssinatura: null
                    };
                    
                    recibosGerados.unshift(novoRecibo);
                    localStorage.setItem(RECIBOS_STORAGE_KEY, JSON.stringify(recibosGerados));
                }
            }

            function atualizarReciboVisualizacao(reciboData) {
                const reciboContainer = elements.reciboResult.querySelector('.recibo-container .p-6');
                reciboContainer.innerHTML = `
                    <div class="mb-6">
                        <div class="flex justify-between mb-1">
                            <span class="font-semibold text-primary-dark">DATA:</span>
                            <span>${reciboData.data}</span>
                        </div>
                        <div class="section-divider my-3"></div>
                        
                        <div class="mb-1">
                            <span class="font-semibold text-primary-dark">TIPO DE MATERIAL:</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-xs text-gray-500">(TI, Suprimentos, Marketing, Doações, outros...)</span>
                            <span class="font-medium">${reciboData.tipoMaterial}</span>
                        </div>
                        <div class="section-divider my-3"></div>
                        
                        <div class="flex justify-between mb-1">
                            <span class="font-semibold text-primary-dark">DESTINO:</span>
                            <span class="recibo-destino">${reciboData.destino}</span>
                        </div>
                    </div>

                    <div class="section-divider my-3"></div>

                    <div class="mb-6">
                        <div class="font-semibold text-primary-dark mb-2">MATERIAL E QUANTIDADE</div>
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                            <div class="font-medium text-base">
                                <div><span class="font-semibold">Material:</span> ${reciboData.material || 'Não informado'}</div>
                                <div class="flex justify-between">
                                    <div ${!reciboData.chamado ? 'style="display:none;"' : ''}><span class="font-semibold">Chamado:</span> ${reciboData.chamado || ''}</div>
                                    <div><span class="font-semibold">Data de envio:</span> ${reciboData.data}</div>
                                </div>
                                <div class="flex justify-between">
                                    <div><span class="font-semibold">Enviado por:</span> ${reciboData.responsavelEntrega}</div>
                                    <div><span class="font-semibold">Quantidade de volumes:</span> ${reciboData.quantidadeVolumes}</div>
                                </div>
                                <div class="flex justify-between">
                                    <div ${!reciboData.ac ? 'style="display:none;"' : ''}><span class="font-semibold">A/C:</span> ${reciboData.ac || ''}</div>
                                    <div ${!reciboData.observacao ? 'style="display:none;"' : ''}><span class="font-semibold">Observação:</span> ${reciboData.observacao || ''}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider my-3"></div>
                    
                    <div class="font-semibold text-primary-dark mb-2">TRANSLADO INTERNO</div>
                    
                    <div class="expedition-wrapper mb-6">
                        <div class="expedition-container">
                            <div class="font-semibold text-primary-dark mb-2 whitespace-nowrap">Entrega na Expedição</div>
                            <div class="font-medium">${reciboData.responsavelEntrega}</div>
                            <div class="mt-3">
                                <div class="text-xs text-gray-500">Horário de entrega:</div>
                                <div class="font-medium">${reciboData.horarioEntrega}</div>
                            </div>
                        </div>
                        
                        <div class="expedition-container">
                            <div class="font-semibold text-primary-dark mb-2 whitespace-nowrap">Recebimento na Expedição</div>
                            <div class="signature-pad-container no-print">
                                <canvas class="signature-pad"></canvas>
                                <div class="signature-actions mt-2">
                                    <button type="button" class="clear-signature px-2 py-1 bg-gray-200 text-gray-800 rounded text-xs">
                                        <i class="fas fa-eraser mr-1"></i> Limpar
                                    </button>
                                    <button type="button" class="save-signature px-2 py-1 bg-primary text-white rounded text-xs ml-1">
                                        <i class="fas fa-save mr-1"></i> Salvar
                                    </button>
                                </div>
                            </div>
                            <div class="signature-image print-only" style="display: none;">
                                <!-- Assinatura será inserida aqui -->
                            </div>
                            <div class="mt-3">
                                <div class="text-xs text-gray-500">Horário de recebimento:</div>
                                <div class="text-gray-500">_______________</div>
                            </div>
                        </div>
                        
                        <div class="expedition-container">
                            <div class="font-semibold text-primary-dark mb-2 whitespace-nowrap">Retirada da Expedição</div>
                            <div class="flex items-center h-16">
                                <div class="assinatura-line"></div>
                            </div>
                            <div class="mt-3">
                                <div class="text-xs text-gray-500">Horário de retirada:</div>
                                <div class="text-gray-500">_______________</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-divider my-3"></div>

                    <div class="mb-6">
                        <div class="font-semibold text-primary-dark mb-2">RECEBIMENTO NO DESTINO</div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="mb-4">
                                <div class="text-xs text-gray-500 mb-1">Responsável pelo recebimento do material no destino:</div>
                                <div class="flex items-center h-10">
                                    <div class="assinatura-line w-full"></div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-5 gap-4">
                                <div class="col-span-2">
                                    <div class="text-xs text-gray-500 mb-1">Horário do Recebimento:</div>
                                    <div class="flex items-center h-10">
                                        <span>_______________________________</span>
                                    </div>
                                </div>
                                <div class="col-span-3">
                                    <div class="text-xs text-gray-500 mb-1">Data do Recebimento:</div>
                                    <div class="flex items-center gap-2 h-10">
                                        <span>_________</span>
                                        <span>/</span>
                                        <span>_________</span>
                                        <span>/</span>
                                        <span>____________</span>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6 text-center">
                                <div class="text-base font-bold mb-2">CARIMBO</div>
                                <div class="text-xs text-gray-500">[Obrigatório o carimbo pelo responsável da loja]</div>
                            </div>
                        </div>
                    </div>

                    <div class="print-only text-center py-4 border-t border-dashed border-gray-300 mt-6">
                        <p class="text-xs text-gray-500">Recibo gerado pelo Sistema de Controle de Materiais - TI CD Magé em ${new Date().toLocaleString('pt-BR')}</p>
                    </div>
                `;

                // Configurar a área de assinatura no recibo gerado
                setupSignaturePadRecibo();
            }

            function setupSignaturePadRecibo() {
                const canvas = document.querySelector(".recibo-container .signature-pad");
                if (!canvas) return;

                const signaturePadRecibo = new SignaturePad(canvas, {
                    backgroundColor: 'rgb(255, 255, 255)',
                    penColor: 'rgb(0, 0, 0)'
                });

                // Ajustar tamanho do canvas
                function resizeCanvas() {
                    const ratio = Math.max(window.devicePixelRatio || 1, 1);
                    canvas.width = canvas.offsetWidth * ratio;
                    canvas.height = canvas.offsetHeight * ratio;
                    canvas.getContext("2d").scale(ratio, ratio);
                    signaturePadRecibo.clear();
                }

                window.addEventListener('resize', resizeCanvas);
                resizeCanvas();

                // Configurar botões de assinatura no recibo
                document.querySelector(".recibo-container .clear-signature").addEventListener("click", () => {
                    signaturePadRecibo.clear();
                });

                document.querySelector(".recibo-container .save-signature").addEventListener("click", () => {
                    if (signaturePadRecibo.isEmpty()) {
                        alert("Por favor, forneça sua assinatura");
                        return;
                    }

                    const signatureImage = signaturePadRecibo.toDataURL();
                    document.querySelector(".recibo-container .signature-image").innerHTML = `<img src="${signatureImage}" alt="Assinatura">`;
                    document.querySelector(".recibo-container .signature-image").style.display = "block";
                    alert("Assinatura salva com sucesso! Pode imprimir o recibo.");
                });
            }

            // Funções para impressão
            function imprimirReciboHandler() {
                if (verificarCamposObrigatorios()) {
                    const printDateEl = document.createElement('div');
                    printDateEl.id = 'print-date';
                    printDateEl.textContent = new Date().toLocaleString('pt-BR');
                    elements.reciboResult.querySelector('.print-only').appendChild(printDateEl);
                    
                    // Esconder elementos interativos
                    document.querySelectorAll('.no-print').forEach(el => {
                        el.style.display = 'none';
                    });
                    
                    // Mostrar assinatura se existir
                    const signatureImage = document.querySelector(".recibo-container .signature-image img");
                    if (signatureImage) {
                        document.querySelector(".recibo-container .signature-image").style.display = 'block';
                    }
                    
                    window.print();
                    
                    // Restaurar elementos após impressão
                    setTimeout(() => {
                        document.querySelectorAll('.no-print').forEach(el => {
                            el.style.display = '';
                        });
                    }, 500);
                } else {
                    alert('Preencha todos os campos obrigatórios antes de imprimir!');
                }
            }

            function mostrarPreviewEtiqueta() {
                if (!verificarCamposObrigatorios()) {
                    alert('Preencha todos os campos obrigatórios primeiro!');
                    return;
                }

                const material = elements.materialLojaInput.value;
                const chamado = elements.chamadoLoja.value || 'Não informado';
                const ac = elements.acLoja.value || '';
                const observacao = elements.observacao.value || '';
                const data = elements.data.value;
                const destino = elements.destino.value;
                const responsavelEntrega = document.querySelector('input[name="responsavelEntrega"]:checked').value;
                const quantidadeVolumes = elements.quantidadeVolumes.value;
                
                elements.etiquetaPreview.innerHTML = `
                    <div class="etiqueta-venancio-header">
                        <img src="https://images.weare365.io/filters:format(.webp)/1920x0/BR_Drogaria_Venancio_406afbed06.png" alt="Drogaria Venancio" style="height:13pt;width:auto;object-fit:contain;">
                        <div>Translado TI</div>
                    </div>
                    <div class="etiqueta-venancio-content">
                        <div class="etiqueta-venancio-field full-width">
                            <div><strong>Material: ${material || 'Não informado'}</strong></div>
                        </div>
                        <div class="etiqueta-venancio-field full-width combined-line">
                            <div class="left-align"><strong>Chamado: ${chamado}</strong></div>
                            <div class="right-align"><strong>Data de envio: ${data}</strong></div>
                        </div>
                        <div class="etiqueta-venancio-field full-width">
                            <div><strong>CD Magé →</strong> <span class="destino-destaque">${destino}</span></div>
                        </div>
                        <div class="etiqueta-venancio-field full-width combined-line">
                            <div class="left-align"><strong>Enviado por: ${responsavelEntrega}</strong></div>
                            <div class="right-align"><strong>Quantidade: 1 / ${quantidadeVolumes}</strong></div>
                        </div>
                        ${ac ? `<div class="etiqueta-venancio-field full-width"><div><strong>A/C: ${ac}</strong></div></div>` : ''}
                        ${observacao ? `<div class="etiqueta-venancio-field full-width"><div><strong>Obs: ${observacao}</strong></div></div>` : ''}
                    </div>
                `;
                
                elements.etiquetaModal.style.display = "block";
            }

            function imprimirEtiquetas() {
                const quantidadeVolumes = parseInt(elements.quantidadeVolumes.value);
                const material = elements.materialLojaInput.value;
                const chamado = elements.chamadoLoja.value || 'Não informado';
                const ac = elements.acLoja.value || '';
                const observacao = elements.observacao.value || '';
                const data = elements.data.value;
                const destino = elements.destino.value;
                const responsavelEntrega = document.querySelector('input[name="responsavelEntrega"]:checked').value;
                
                // Criar janela de impressão
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Não foi possível abrir a janela de impressão. Por favor, desative o bloqueador de pop-ups para este site.');
                    return;
                }
                
                // Gerar o HTML com todas as etiquetas
                let etiquetasHTML = '';
                for (let i = 1; i <= quantidadeVolumes; i++) {
                    etiquetasHTML += `
                    <div class="etiqueta-print-page">
                        <div class="etiqueta-venancio etiqueta-loja">
                            <div class="etiqueta-venancio-header">
                                <img src="https://images.weare365.io/filters:format(.webp)/1920x0/BR_Drogaria_Venancio_406afbed06.png" alt="Drogaria Venancio">
                                <div>Translado TI</div>
                            </div>
                            <div class="etiqueta-venancio-content">
                                <div class="etiqueta-venancio-field full-width">
                                    <div><strong>Material: ${material}</strong></div>
                                </div>
                                <div class="etiqueta-venancio-field full-width combined-line">
                                    <div class="left-align"><strong>Chamado: ${chamado}</strong></div>
                                    <div class="right-align"><strong>Data de envio: ${data}</strong></div>
                                </div>
                                <div class="etiqueta-venancio-field full-width">
                                    <div><strong>CD Magé →</strong> <span class="destino-destaque">${destino}</span></div>
                                </div>
                                <div class="etiqueta-venancio-field full-width combined-line">
                                    <div class="left-align"><strong>Enviado por: ${responsavelEntrega}</strong></div>
                                    <div class="right-align"><strong>Quantidade: ${i} / ${quantidadeVolumes}</strong></div>
                                </div>
                                ${ac ? `<div class="etiqueta-venancio-field full-width"><div><strong>A/C: ${ac}</strong></div></div>` : ''}
                                ${observacao ? `<div class="etiqueta-venancio-field full-width"><div><strong>Obs: ${observacao}</strong></div></div>` : ''}
                            </div>
                        </div>
                    </div>
                    `;
                }

                printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Etiquetas (${quantidadeVolumes} unidades)</title>
                    <style>
                        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
                        @page { size: 100mm 50mm; margin: 0; }
                        .etiqueta-print-page {
                            width: 100mm; height: 50mm; margin: 0; padding: 0;
                            page-break-after: always;
                        }
                        .etiqueta-venancio {
                            width: 100mm; height: 50mm; padding: 3mm;
                            box-sizing: border-box; font-family: Arial, sans-serif;
                            background-color: white; display: flex; flex-direction: column;
                            font-size: 10pt;
                        }
                        .etiqueta-venancio-header {
                            display: flex; justify-content: space-between;
                            align-items: center; margin-bottom: 1mm;
                            padding-bottom: 1mm; border-bottom: 1px solid #000;
                            font-weight: bold; font-size: 12pt;
                        }
                        .etiqueta-venancio-header img {
                            height: 13pt; width: auto; object-fit: contain;
                        }
                        .etiqueta-venancio-content {
                            flex: 1; display: flex; flex-direction: column;
                            gap: 1mm; padding: 2mm 0;
                        }
                        .etiqueta-venancio-field { display: flex; width: 100%; }
                        .full-width { width: 100%; }
                        .combined-line { display: flex; justify-content: space-between; }
                        .left-align { text-align: left; }
                        .right-align { text-align: right; }
                        strong { font-weight: bold; }
                        .destino-destaque {
                            font-weight: bold; font-size: 17pt;
                            background-color: rgb(0, 0, 0);
                            color: #e2e8f0; padding: 0 2px;
                        }
                    </style>
                </head>
                <body>${etiquetasHTML}</body>
                </html>
                `);
                printWindow.document.close();
                
                // Fechar o modal
                fecharModalEtiqueta();
                
                // Imprimir após carregamento
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                        printWindow.close();
                    }, 200);
                };
            }

            // Funções para histórico
            function mostrarHistorico() {
                elements.mainScreen.classList.add('hidden');
                elements.historicoScreen.classList.remove('hidden');
                atualizarListaRecibos();
            }

            function voltarParaPrincipalHandler() {
                elements.historicoScreen.classList.add('hidden');
                elements.mainScreen.classList.remove('hidden');
            }

            function atualizarListaRecibos() {
                elements.listaRecibos.innerHTML = '';
                
                if (recibosGerados.length === 0) {
                    elements.listaRecibos.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum recibo encontrado</p>';
                    return;
                }
                
                recibosGerados.forEach(recibo => {
                    const reciboElement = document.createElement("div");
                    reciboElement.className = "bg-gray-50 p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow";
                    reciboElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold">Recibo #${recibo.id}</h3>
                                <p class="text-sm text-gray-600">${recibo.destino} - ${new Date(recibo.dataCriacao).toLocaleString()}</p>
                                <p class="mt-2">Material: ${recibo.material || 'Não informado'}</p>
                                ${recibo.assinado ? 
                                    `<p class="mt-1 text-sm text-green-600">
                                        <i class="fas fa-check-circle mr-1"></i> Assinado em ${new Date(recibo.dataAssinatura).toLocaleString()}
                                    </p>` : 
                                    '<p class="mt-1 text-sm text-yellow-600"><i class="fas fa-exclamation-circle mr-1"></i> Pendente de assinatura</p>'
                                }
                            </div>
                            <div class="flex flex-col space-y-2">
                                ${!recibo.assinado ? 
                                    `<button onclick="prepararAssinatura(${recibo.id})" class="px-3 py-1 bg-primary text-white rounded text-sm whitespace-nowrap">
                                        <i class="fas fa-signature mr-1"></i> Assinar
                                    </button>` : 
                                    `<button onclick="gerarPDF(${recibo.id})" class="px-3 py-1 bg-green-600 text-white rounded text-sm whitespace-nowrap">
                                        <i class="fas fa-file-pdf mr-1"></i> Gerar PDF
                                    </button>`
                                }
                                <button onclick="visualizarRecibo(${recibo.id})" class="px-3 py-1 bg-blue-600 text-white rounded text-sm whitespace-nowrap">
                                    <i class="fas fa-eye mr-1"></i> Visualizar
                                </button>
                            </div>
                        </div>
                    `;
                    elements.listaRecibos.appendChild(reciboElement);
                });
            }

            function filtrarRecibos() {
                const termo = elements.buscaRecibo.value.toLowerCase();
                if (!termo) {
                    atualizarListaRecibos();
                    return;
                }
                
                const recibosFiltrados = recibosGerados.filter(recibo => 
                    recibo.destino.toLowerCase().includes(termo) ||
                    (recibo.material && recibo.material.toLowerCase().includes(termo)) ||
                    (recibo.chamado && recibo.chamado.toLowerCase().includes(termo)) ||
                    (recibo.ac && recibo.ac.toLowerCase().includes(termo))
                );
                
                if (recibosFiltrados.length === 0) {
                    elements.listaRecibos.innerHTML = '<p class="text-center text-gray-500 py-4">Nenhum recibo encontrado para "' + termo + '"</p>';
                    return;
                }
                
                elements.listaRecibos.innerHTML = '';
                recibosFiltrados.forEach(recibo => {
                    const reciboElement = document.createElement("div");
                    reciboElement.className = "bg-gray-50 p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow";
                    reciboElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold">Recibo #${recibo.id}</h3>
                                <p class="text-sm text-gray-600">${recibo.destino} - ${new Date(recibo.dataCriacao).toLocaleString()}</p>
                                <p class="mt-2">Material: ${recibo.material || 'Não informado'}</p>
                            </div>
                            <div class="flex space-x-2">
                                ${!recibo.assinado ? 
                                    `<button onclick="prepararAssinatura(${recibo.id})" class="px-3 py-1 bg-primary text-white rounded text-sm">
                                        <i class="fas fa-signature mr-1"></i> Assinar
                                    </button>` : 
                                    `<button onclick="gerarPDF(${recibo.id})" class="px-3 py-1 bg-green-600 text-white rounded text-sm">
                                        <i class="fas fa-file-pdf mr-1"></i> Gerar PDF
                                    </button>`
                                }
                            </div>
                        </div>
                        ${recibo.assinado ? 
                            `<p class="mt-2 text-sm text-green-600">
                                <i class="fas fa-check-circle mr-1"></i> Assinado em ${new Date(recibo.dataAssinatura).toLocaleString()}
                            </p>` : 
                            '<p class="mt-2 text-sm text-yellow-600"><i class="fas fa-exclamation-circle mr-1"></i> Pendente de assinatura</p>'
                        }
                    `;
                    elements.listaRecibos.appendChild(reciboElement);
                });
            }

            function limparBusca() {
                elements.buscaRecibo.value = '';
                atualizarListaRecibos();
            }

            // Funções para assinatura digital
            function prepararAssinatura(reciboId) {
                const recibo = recibosGerados.find(r => r.id == reciboId);
                if (!recibo) return;
                
                reciboAtualParaAssinar = recibo;
                elements.reciboId.textContent = recibo.id;
                elements.reciboResumo.innerHTML = `
                    <p><strong>Destino:</strong> ${recibo.destino}</p>
                    <p><strong>Material:</strong> ${recibo.material || 'Não informado'}</p>
                    <p><strong>Data:</strong> ${recibo.data}</p>
                `;
                
                signaturePad.clear();
                elements.assinaturaModal.style.display = "block";
            }

            function limparAssinatura() {
                signaturePad.clear();
            }

            function salvarAssinatura() {
                if (signaturePad.isEmpty()) {
                    alert("Por favor, forneça sua assinatura");
                    return;
                }
                
                if (reciboAtualParaAssinar) {
                    reciboAtualParaAssinar.assinatura = signaturePad.toDataURL();
                    reciboAtualParaAssinar.assinado = true;
                    reciboAtualParaAssinar.dataAssinatura = new Date().toISOString();
                    localStorage.setItem(RECIBOS_STORAGE_KEY, JSON.stringify(recibosGerados));
                    
                    alert("Assinatura salva com sucesso!");
                    signaturePad.clear();
                    atualizarListaRecibos();
                }
            }

            function fecharModalAssinatura() {
                elements.assinaturaModal.style.display = "none";
                reciboAtualParaAssinar = null;
            }

            function fecharModalEtiqueta() {
                elements.etiquetaModal.style.display = "none";
            }

            // Função para gerar PDF
            function gerarPDFHandler() {
                if (!reciboAtualParaAssinar) return;
                gerarPDF(reciboAtualParaAssinar.id);
            }

            function gerarPDF(reciboId) {
                const recibo = recibosGerados.find(r => r.id == reciboId);
                if (!recibo) return;

                // Criar novo PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configurações do PDF
                doc.setProperties({
                    title: `Recibo ${recibo.id}`,
                    subject: 'Recibo de Materiais',
                    author: 'Sistema CD Caxias',
                    keywords: 'recibo, materiais, cd, caxias',
                    creator: 'Sistema de Recibos'
                });
                
                // Adicionar cabeçalho
                doc.setFontSize(16);
                doc.setTextColor(15, 123, 151); // Cor primária
                doc.text("RECIBO DE MATERIAIS", 105, 20, { align: 'center' });
                
                // Adicionar informações do recibo
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0); // Preto
                doc.text(`Data: ${recibo.data}`, 20, 40);
                doc.text(`Destino: ${recibo.destino}`, 20, 50);
                doc.text(`Material: ${recibo.material || 'Não informado'}`, 20, 60);
                
                if (recibo.chamado) {
                    doc.text(`Chamado: ${recibo.chamado}`, 20, 70);
                }
                
                if (recibo.ac) {
                    doc.text(`A/C: ${recibo.ac}`, 20, 80);
                }
                
                doc.text(`Quantidade de volumes: ${recibo.quantidadeVolumes}`, 20, 90);
                doc.text(`Enviado por: ${recibo.responsavelEntrega}`, 20, 100);
                
                if (recibo.observacao) {
                    doc.text(`Observação: ${recibo.observacao}`, 20, 110);
                }
                
                // Adicionar assinatura se existir
                if (recibo.assinatura) {
                    const imgData = recibo.assinatura;
                    doc.addImage(imgData, 'PNG', 20, 150, 60, 30);
                    doc.text("Assinatura Digital", 20, 185);
                    doc.text(`Data da assinatura: ${new Date(recibo.dataAssinatura).toLocaleString('pt-BR')}`, 20, 195);
                }
                
                // Adicionar rodapé
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Recibo gerado em ${new Date(recibo.dataCriacao).toLocaleString('pt-BR')}`, 105, 280, { align: 'center' });
                doc.text("Sistema de Controle de Materiais - TI CD Magé", 105, 285, { align: 'center' });
                
                // Salvar PDF
                doc.save(`recibo_${recibo.id}.pdf`);
                recibo.pdfGerado = true;
                localStorage.setItem(RECIBOS_STORAGE_KEY, JSON.stringify(recibosGerados));
                atualizarListaRecibos();
                fecharModalAssinatura();
            }

            // Função para visualizar recibo
            function visualizarRecibo(reciboId) {
                const recibo = recibosGerados.find(r => r.id == reciboId);
                if (!recibo) return;
                
                elements.reciboResult.classList.remove('hidden');
                atualizarReciboVisualizacao(recibo);
                
                // Rolagem suave até o recibo
                elements.reciboResult.scrollIntoView({ behavior: 'smooth' });
            }

            // Expor funções globais para os eventos onclick
            window.prepararAssinatura = prepararAssinatura;
            window.gerarPDF = gerarPDF;
            window.visualizarRecibo = visualizarRecibo;

            // Inicializar aplicação
            init();
        });
    </script>
</body>
</html>